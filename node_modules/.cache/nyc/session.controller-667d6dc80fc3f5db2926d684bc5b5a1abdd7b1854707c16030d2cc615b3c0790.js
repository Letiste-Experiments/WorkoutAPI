function cov_24v3fyto2n(){var path="/home/leo/workout-api/api/controllers/session.controller.js";var hash="4792fe419ee295ff5686357c48bd7bc3ea1b3efd";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/home/leo/workout-api/api/controllers/session.controller.js",statementMap:{"0":{start:{line:1,column:15},end:{line:1,column:36}},"1":{start:{line:2,column:11},end:{line:2,column:31}},"2":{start:{line:3,column:13},end:{line:3,column:21}},"3":{start:{line:4,column:22},end:{line:4,column:37}},"4":{start:{line:6,column:28},end:{line:6,column:36}},"5":{start:{line:8,column:0},end:{line:37,column:1}},"6":{start:{line:9,column:14},end:{line:9,column:16}},"7":{start:{line:9,column:29},end:{line:9,column:31}},"8":{start:{line:10,column:2},end:{line:13,column:3}},"9":{start:{line:11,column:4},end:{line:11,column:26}},"10":{start:{line:12,column:4},end:{line:12,column:32}},"11":{start:{line:14,column:2},end:{line:36,column:3}},"12":{start:{line:15,column:17},end:{line:15,column:60}},"13":{start:{line:16,column:18},end:{line:16,column:69}},"14":{start:{line:18,column:4},end:{line:32,column:5}},"15":{start:{line:19,column:6},end:{line:19,column:34}},"16":{start:{line:21,column:6},end:{line:27,column:7}},"17":{start:{line:22,column:8},end:{line:22,column:34}},"18":{start:{line:23,column:8},end:{line:23,column:64}},"19":{start:{line:24,column:8},end:{line:24,column:25}},"20":{start:{line:25,column:8},end:{line:25,column:51}},"21":{start:{line:26,column:8},end:{line:26,column:55}},"22":{start:{line:28,column:6},end:{line:28,column:27}},"23":{start:{line:29,column:6},end:{line:29,column:33}},"24":{start:{line:31,column:6},end:{line:31,column:70}},"25":{start:{line:34,column:4},end:{line:34,column:68}},"26":{start:{line:39,column:0},end:{line:67,column:1}},"27":{start:{line:40,column:2},end:{line:66,column:3}},"28":{start:{line:41,column:4},end:{line:41,column:55}},"29":{start:{line:44,column:4},end:{line:64,column:5}},"30":{start:{line:45,column:21},end:{line:45,column:39}},"31":{start:{line:46,column:19},end:{line:46,column:46}},"32":{start:{line:47,column:30},end:{line:47,column:50}},"33":{start:{line:49,column:6},end:{line:61,column:7}},"34":{start:{line:50,column:23},end:{line:50,column:87}},"35":{start:{line:51,column:8},end:{line:51,column:35}},"36":{start:{line:52,column:8},end:{line:57,column:9}},"37":{start:{line:53,column:10},end:{line:53,column:29}},"38":{start:{line:54,column:10},end:{line:54,column:27}},"39":{start:{line:56,column:10},end:{line:56,column:23}},"40":{start:{line:59,column:8},end:{line:59,column:27}},"41":{start:{line:60,column:8},end:{line:60,column:25}},"42":{start:{line:63,column:6},end:{line:63,column:19}},"43":{start:{line:65,column:4},end:{line:65,column:32}},"44":{start:{line:69,column:0},end:{line:77,column:1}},"45":{start:{line:70,column:2},end:{line:76,column:3}},"46":{start:{line:71,column:4},end:{line:71,column:59}},"47":{start:{line:73,column:4},end:{line:73,column:29}},"48":{start:{line:74,column:4},end:{line:74,column:37}},"49":{start:{line:75,column:4},end:{line:75,column:59}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:8,column:17},end:{line:8,column:18}},loc:{start:{line:8,column:37},end:{line:37,column:1}},line:8},"1":{name:"(anonymous_1)",decl:{start:{line:39,column:14},end:{line:39,column:15}},loc:{start:{line:39,column:34},end:{line:67,column:1}},line:39},"2":{name:"(anonymous_2)",decl:{start:{line:69,column:17},end:{line:69,column:18}},loc:{start:{line:69,column:31},end:{line:77,column:1}},line:69}},branchMap:{"0":{loc:{start:{line:10,column:2},end:{line:13,column:3}},type:"if",locations:[{start:{line:10,column:2},end:{line:13,column:3}},{start:{line:10,column:2},end:{line:13,column:3}}],line:10},"1":{loc:{start:{line:18,column:4},end:{line:32,column:5}},type:"if",locations:[{start:{line:18,column:4},end:{line:32,column:5}},{start:{line:18,column:4},end:{line:32,column:5}}],line:18},"2":{loc:{start:{line:21,column:6},end:{line:27,column:7}},type:"if",locations:[{start:{line:21,column:6},end:{line:27,column:7}},{start:{line:21,column:6},end:{line:27,column:7}}],line:21},"3":{loc:{start:{line:40,column:2},end:{line:66,column:3}},type:"if",locations:[{start:{line:40,column:2},end:{line:66,column:3}},{start:{line:40,column:2},end:{line:66,column:3}}],line:40},"4":{loc:{start:{line:44,column:4},end:{line:64,column:5}},type:"if",locations:[{start:{line:44,column:4},end:{line:64,column:5}},{start:{line:44,column:4},end:{line:64,column:5}}],line:44},"5":{loc:{start:{line:49,column:6},end:{line:61,column:7}},type:"if",locations:[{start:{line:49,column:6},end:{line:61,column:7}},{start:{line:49,column:6},end:{line:61,column:7}}],line:49},"6":{loc:{start:{line:52,column:8},end:{line:57,column:9}},type:"if",locations:[{start:{line:52,column:8},end:{line:57,column:9}},{start:{line:52,column:8},end:{line:57,column:9}}],line:52},"7":{loc:{start:{line:70,column:2},end:{line:76,column:3}},type:"if",locations:[{start:{line:70,column:2},end:{line:76,column:3}},{start:{line:70,column:2},end:{line:76,column:3}}],line:70}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0},f:{"0":0,"1":0,"2":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"4792fe419ee295ff5686357c48bd7bc3ea1b3efd"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_24v3fyto2n=function(){return actualCoverage;};}return actualCoverage;}cov_24v3fyto2n();const argon2=(cov_24v3fyto2n().s[0]++,require("phc-argon2"));const db=(cov_24v3fyto2n().s[1]++,require("../models"));const User=(cov_24v3fyto2n().s[2]++,db.users);const{v4:genuuid}=(cov_24v3fyto2n().s[3]++,require('uuid'));const ONE_YEAR_IN_SECONDS=(cov_24v3fyto2n().s[4]++,31556952);cov_24v3fyto2n().s[5]++;exports.create=async(req,res)=>{cov_24v3fyto2n().f[0]++;let email=(cov_24v3fyto2n().s[6]++,""),password=(cov_24v3fyto2n().s[7]++,"");cov_24v3fyto2n().s[8]++;if(req.body){cov_24v3fyto2n().b[0][0]++;cov_24v3fyto2n().s[9]++;email=req.body.email;cov_24v3fyto2n().s[10]++;password=req.body.password;}else{cov_24v3fyto2n().b[0][1]++;}cov_24v3fyto2n().s[11]++;try{const user=(cov_24v3fyto2n().s[12]++,await User.findOne({where:{email:email}}));const match=(cov_24v3fyto2n().s[13]++,await argon2.verify(user.password_digest,password));cov_24v3fyto2n().s[14]++;if(match){cov_24v3fyto2n().b[1][0]++;cov_24v3fyto2n().s[15]++;req.session.userid=user.id;cov_24v3fyto2n().s[16]++;if(req.body.rememberMe){cov_24v3fyto2n().b[2][0]++;cov_24v3fyto2n().s[17]++;remember_token=genuuid();cov_24v3fyto2n().s[18]++;user.remember_digest=await argon2.hash(remember_token);cov_24v3fyto2n().s[19]++;await user.save();cov_24v3fyto2n().s[20]++;req.session.remember_token=remember_token;cov_24v3fyto2n().s[21]++;req.session.cookie.maxAge=ONE_YEAR_IN_SECONDS;}else{cov_24v3fyto2n().b[2][1]++;}cov_24v3fyto2n().s[22]++;req.session.views=1;cov_24v3fyto2n().s[23]++;res.send({userid:user.id});}else{cov_24v3fyto2n().b[1][1]++;cov_24v3fyto2n().s[24]++;res.status(500).send({message:"Invalid email and/or password"});}}catch{cov_24v3fyto2n().s[25]++;res.status(500).send({message:"Invalid email and/or password"});}};cov_24v3fyto2n().s[26]++;exports.get=async(req,res)=>{cov_24v3fyto2n().f[1]++;cov_24v3fyto2n().s[27]++;if(!req.session){cov_24v3fyto2n().b[3][0]++;cov_24v3fyto2n().s[28]++;res.status(500).send({message:"No session found"});}else{cov_24v3fyto2n().b[3][1]++;let response;cov_24v3fyto2n().s[29]++;if(req.session.userid){cov_24v3fyto2n().b[4][0]++;const userid=(cov_24v3fyto2n().s[30]++,req.session.userid);const user=(cov_24v3fyto2n().s[31]++,await User.findByPk(userid));const remember_digest=(cov_24v3fyto2n().s[32]++,user.remember_digest);cov_24v3fyto2n().s[33]++;if(req.session.remember_token){cov_24v3fyto2n().b[5][0]++;const result=(cov_24v3fyto2n().s[34]++,await argon2.verify(remember_digest,req.session.remember_token));cov_24v3fyto2n().s[35]++;console.log("RES",result);cov_24v3fyto2n().s[36]++;if(result){cov_24v3fyto2n().b[6][0]++;cov_24v3fyto2n().s[37]++;req.session.views++;cov_24v3fyto2n().s[38]++;response=userid;}else{cov_24v3fyto2n().b[6][1]++;cov_24v3fyto2n().s[39]++;response=-1;}}else{cov_24v3fyto2n().b[5][1]++;cov_24v3fyto2n().s[40]++;req.session.views++;cov_24v3fyto2n().s[41]++;response=userid;}}else{cov_24v3fyto2n().b[4][1]++;cov_24v3fyto2n().s[42]++;response=-1;}cov_24v3fyto2n().s[43]++;res.send({userid:response});}};cov_24v3fyto2n().s[44]++;exports.delete=(req,res)=>{cov_24v3fyto2n().f[2]++;cov_24v3fyto2n().s[45]++;if(!req.session){cov_24v3fyto2n().b[7][0]++;cov_24v3fyto2n().s[46]++;res.status(500).send({message:"No session to delete"});}else{cov_24v3fyto2n().b[7][1]++;cov_24v3fyto2n().s[47]++;req.session.userid=null;cov_24v3fyto2n().s[48]++;req.session.remember_token=null;cov_24v3fyto2n().s[49]++;res.send({message:"Session was deleted successfully"});}};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNlc3Npb24uY29udHJvbGxlci5qcyJdLCJuYW1lcyI6WyJhcmdvbjIiLCJyZXF1aXJlIiwiZGIiLCJVc2VyIiwidXNlcnMiLCJ2NCIsImdlbnV1aWQiLCJPTkVfWUVBUl9JTl9TRUNPTkRTIiwiZXhwb3J0cyIsImNyZWF0ZSIsInJlcSIsInJlcyIsImVtYWlsIiwicGFzc3dvcmQiLCJib2R5IiwidXNlciIsImZpbmRPbmUiLCJ3aGVyZSIsIm1hdGNoIiwidmVyaWZ5IiwicGFzc3dvcmRfZGlnZXN0Iiwic2Vzc2lvbiIsInVzZXJpZCIsImlkIiwicmVtZW1iZXJNZSIsInJlbWVtYmVyX3Rva2VuIiwicmVtZW1iZXJfZGlnZXN0IiwiaGFzaCIsInNhdmUiLCJjb29raWUiLCJtYXhBZ2UiLCJ2aWV3cyIsInNlbmQiLCJzdGF0dXMiLCJtZXNzYWdlIiwiZ2V0IiwicmVzcG9uc2UiLCJmaW5kQnlQayIsInJlc3VsdCIsImNvbnNvbGUiLCJsb2ciLCJkZWxldGUiXSwibWFwcGluZ3MiOiJzcExBZVk7MkZBZlosS0FBTUEsQ0FBQUEsTUFBTSwwQkFBR0MsT0FBTyxDQUFDLFlBQUQsQ0FBVixDQUFaLENBQ0EsS0FBTUMsQ0FBQUEsRUFBRSwwQkFBR0QsT0FBTyxDQUFDLFdBQUQsQ0FBVixDQUFSLENBQ0EsS0FBTUUsQ0FBQUEsSUFBSSwwQkFBR0QsRUFBRSxDQUFDRSxLQUFOLENBQVYsQ0FDQSxLQUFNLENBQUNDLEVBQUUsQ0FBRUMsT0FBTCwyQkFBZ0JMLE9BQU8sQ0FBQyxNQUFELENBQXZCLENBQU4sQ0FFQSxLQUFNTSxDQUFBQSxtQkFBbUIsMEJBQUcsUUFBSCxDQUF6QixDLHdCQUVBQyxPQUFPLENBQUNDLE1BQVIsQ0FBaUIsTUFBT0MsR0FBUCxDQUFZQyxHQUFaLEdBQW9CLHlCQUNuQyxHQUFJQyxDQUFBQSxLQUFLLDBCQUFHLEVBQUgsQ0FBVCxDQUFnQkMsUUFBUSwwQkFBRyxFQUFILENBQXhCLENBRG1DLHdCQUVuQyxHQUFJSCxHQUFHLENBQUNJLElBQVIs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QUFtQkYsTUFBbkIsRUFGOEIseUJBRzlCLEdBQUlBLE1BQUosQ0FBWSxxREFDVjVCLEdBQUcsQ0FBQ1csT0FBSixDQUFZVSxLQUFaLEdBRFUseUJBRVZLLFFBQVEsQ0FBR2QsTUFBWCxDQUNELENBSEQsSUFHTyxxREFDTGMsUUFBUSxDQUFHLENBQUMsQ0FBWixDQUNELENBQ0YsQ0FURCxJQVNPLHFEQUNMMUIsR0FBRyxDQUFDVyxPQUFKLENBQVlVLEtBQVosR0FESyx5QkFFTEssUUFBUSxDQUFHZCxNQUFYLENBQ0QsQ0FDRixDQWxCRCxJQWtCTyxxREFDTGMsUUFBUSxDQUFHLENBQUMsQ0FBWixDQUNELENBdEJJLHlCQXVCTHpCLEdBQUcsQ0FBQ3FCLElBQUosQ0FBUyxDQUFDVixNQUFNLENBQUVjLFFBQVQsQ0FBVCxFQUNELENBQ0YsQ0E1QkQsQyx5QkE4QkE1QixPQUFPLENBQUNpQyxNQUFSLENBQWlCLENBQUMvQixHQUFELENBQU1DLEdBQU4sR0FBYyxrREFDN0IsR0FBSSxDQUFDRCxHQUFHLENBQUNXLE9BQVQsQ0FBa0IscURBQ2hCVixHQUFHLENBQUNzQixNQUFKLENBQVcsR0FBWCxFQUFnQkQsSUFBaEIsQ0FBcUIsQ0FBQ0UsT0FBTyxDQUFFLHNCQUFWLENBQXJCLEVBQ0QsQ0FGRCxJQUVPLHFEQUNMeEIsR0FBRyxDQUFDVyxPQUFKLENBQVlDLE1BQVosQ0FBcUIsSUFBckIsQ0FESyx5QkFFTFosR0FBRyxDQUFDVyxPQUFKLENBQVlJLGNBQVosQ0FBNkIsSUFBN0IsQ0FGSyx5QkFHTGQsR0FBRyxDQUFDcUIsSUFBSixDQUFTLENBQUNFLE9BQU8sQ0FBRSxrQ0FBVixDQUFULEVBQ0QsQ0FDRixDQVJEIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgYXJnb24yID0gcmVxdWlyZShcInBoYy1hcmdvbjJcIilcbmNvbnN0IGRiID0gcmVxdWlyZShcIi4uL21vZGVsc1wiKVxuY29uc3QgVXNlciA9IGRiLnVzZXJzXG5jb25zdCB7djQ6IGdlbnV1aWR9ID0gcmVxdWlyZSgndXVpZCcpXG5cbmNvbnN0IE9ORV9ZRUFSX0lOX1NFQ09ORFMgPSAzMTU1Njk1MlxuXG5leHBvcnRzLmNyZWF0ZSA9IGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICBsZXQgZW1haWwgPSBcIlwiLCBwYXNzd29yZCA9IFwiXCJcbiAgaWYgKHJlcS5ib2R5KSB7XG4gICAgZW1haWwgPSByZXEuYm9keS5lbWFpbFxuICAgIHBhc3N3b3JkID0gcmVxLmJvZHkucGFzc3dvcmRcbiAgfVxuICB0cnkge1xuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBVc2VyLmZpbmRPbmUoe3doZXJlOiB7ZW1haWw6IGVtYWlsfX0pXG4gICAgY29uc3QgbWF0Y2ggPSBhd2FpdCBhcmdvbjIudmVyaWZ5KHVzZXIucGFzc3dvcmRfZGlnZXN0LCBwYXNzd29yZClcblxuICAgIGlmIChtYXRjaCkge1xuICAgICAgcmVxLnNlc3Npb24udXNlcmlkID0gdXNlci5pZFxuXG4gICAgICBpZiAocmVxLmJvZHkucmVtZW1iZXJNZSkge1xuICAgICAgICByZW1lbWJlcl90b2tlbiA9IGdlbnV1aWQoKVxuICAgICAgICB1c2VyLnJlbWVtYmVyX2RpZ2VzdCA9IGF3YWl0IGFyZ29uMi5oYXNoKHJlbWVtYmVyX3Rva2VuKVxuICAgICAgICBhd2FpdCB1c2VyLnNhdmUoKVxuICAgICAgICByZXEuc2Vzc2lvbi5yZW1lbWJlcl90b2tlbiA9IHJlbWVtYmVyX3Rva2VuXG4gICAgICAgIHJlcS5zZXNzaW9uLmNvb2tpZS5tYXhBZ2UgPSBPTkVfWUVBUl9JTl9TRUNPTkRTXG4gICAgICB9XG4gICAgICByZXEuc2Vzc2lvbi52aWV3cyA9IDFcbiAgICAgIHJlcy5zZW5kKHt1c2VyaWQ6IHVzZXIuaWR9KVxuICAgIH0gZWxzZSB7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuc2VuZCh7bWVzc2FnZTogXCJJbnZhbGlkIGVtYWlsIGFuZC9vciBwYXNzd29yZFwifSlcbiAgICB9XG4gIH0gY2F0Y2gge1xuICAgIHJlcy5zdGF0dXMoNTAwKS5zZW5kKHttZXNzYWdlOiBcIkludmFsaWQgZW1haWwgYW5kL29yIHBhc3N3b3JkXCJ9KVxuXG4gIH1cbn1cblxuZXhwb3J0cy5nZXQgPSBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgaWYgKCFyZXEuc2Vzc2lvbikge1xuICAgIHJlcy5zdGF0dXMoNTAwKS5zZW5kKHttZXNzYWdlOiBcIk5vIHNlc3Npb24gZm91bmRcIn0pXG4gIH0gZWxzZSB7XG4gICAgbGV0IHJlc3BvbnNlXG4gICAgaWYgKHJlcS5zZXNzaW9uLnVzZXJpZCkge1xuICAgICAgY29uc3QgdXNlcmlkID0gcmVxLnNlc3Npb24udXNlcmlkXG4gICAgICBjb25zdCB1c2VyID0gYXdhaXQgVXNlci5maW5kQnlQayh1c2VyaWQpXG4gICAgICBjb25zdCByZW1lbWJlcl9kaWdlc3QgPSB1c2VyLnJlbWVtYmVyX2RpZ2VzdFxuXG4gICAgICBpZiAocmVxLnNlc3Npb24ucmVtZW1iZXJfdG9rZW4pIHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYXJnb24yLnZlcmlmeShyZW1lbWJlcl9kaWdlc3QsIHJlcS5zZXNzaW9uLnJlbWVtYmVyX3Rva2VuKVxuICAgICAgICBjb25zb2xlLmxvZyhcIlJFU1wiLCByZXN1bHQpO1xuICAgICAgICBpZiAocmVzdWx0KSB7XG4gICAgICAgICAgcmVxLnNlc3Npb24udmlld3MrK1xuICAgICAgICAgIHJlc3BvbnNlID0gdXNlcmlkXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVzcG9uc2UgPSAtMVxuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXEuc2Vzc2lvbi52aWV3cysrXG4gICAgICAgIHJlc3BvbnNlID0gdXNlcmlkXG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHJlc3BvbnNlID0gLTFcbiAgICB9XG4gICAgcmVzLnNlbmQoe3VzZXJpZDogcmVzcG9uc2V9KVxuICB9XG59XG5cbmV4cG9ydHMuZGVsZXRlID0gKHJlcSwgcmVzKSA9PiB7XG4gIGlmICghcmVxLnNlc3Npb24pIHtcbiAgICByZXMuc3RhdHVzKDUwMCkuc2VuZCh7bWVzc2FnZTogXCJObyBzZXNzaW9uIHRvIGRlbGV0ZVwifSlcbiAgfSBlbHNlIHtcbiAgICByZXEuc2Vzc2lvbi51c2VyaWQgPSBudWxsXG4gICAgcmVxLnNlc3Npb24ucmVtZW1iZXJfdG9rZW4gPSBudWxsXG4gICAgcmVzLnNlbmQoe21lc3NhZ2U6IFwiU2Vzc2lvbiB3YXMgZGVsZXRlZCBzdWNjZXNzZnVsbHlcIn0pXG4gIH1cbn1cbiJdfQ==